<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마음 한잔 - 당신의 깊은 곳으로</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500&family=Noto+Sans+KR:wght@300;400;500&display=swap');

        :root {
            --warm-beige: #f9f7f2;
            --soft-brown: #8d6e63;
            --deep-brown: #5d4037;
            --accent-color: #a1887f;
        }

        body {
            margin: 0; padding: 0;
            background-color: var(--warm-beige);
            font-family: 'Noto Sans KR', sans-serif;
            color: var(--deep-brown);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
        }

        .container {
            width: 100%; max-width: 450px; height: 90vh;
            background: #fff; border-radius: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.05);
            display: flex; flex-direction: column; overflow: hidden;
            position: relative;
        }

        /* 헤더 */
        header {
            padding: 25px; border-bottom: 1px solid #f0eeeb;
            text-align: center; background: #fff;
        }
        header h1 { 
            font-family: 'Noto Serif KR', serif; font-size: 1.4rem; margin: 0; color: var(--deep-brown); 
        }

        /* 채팅 영역 */
        #chatDisplay {
            flex: 1; padding: 20px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 15px;
            scroll-behavior: smooth; background: #fafaf9;
        }

        .bubble {
            max-width: 80%; padding: 12px 18px; border-radius: 20px;
            font-size: 0.95rem; line-height: 1.6; position: relative;
            animation: fadeIn 0.5s ease-out forwards;
        }
        .ai {
            align-self: flex-start; background: #fff;
            border: 1px solid #efebe9; border-bottom-left-radius: 2px;
        }
        .user {
            align-self: flex-end; background: var(--soft-brown);
            color: #fff; border-bottom-right-radius: 2px;
        }

        /* 입력 영역 */
        .input-area {
            padding: 20px; background: #fff; border-top: 1px solid #f0eeeb;
            display: flex; flex-direction: column;
        }
        textarea {
            width: 100%; height: 80px; border: none; outline: none;
            resize: none; font-size: 1rem; color: var(--deep-brown);
            font-family: inherit;
        }
        .controls {
            display: flex; justify-content: space-between; align-items: center; margin-top: 10px;
        }
        .step-info { font-size: 0.75rem; color: var(--accent-color); }
        
        button {
            padding: 10px 25px; border: none; border-radius: 25px;
            background: var(--soft-brown); color: white; cursor: pointer;
            font-weight: 500; transition: 0.3s;
        }
        button:disabled { background: #d7ccc8; opacity: 0.6; }

        /* 결과창 */
        #finalResult {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: #fff; display: none; z-index: 10;
            flex-direction: column; justify-content: center; align-items: center;
            padding: 40px; box-sizing: border-box; text-align: center;
            animation: slideUp 0.6s ease-out;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes slideUp { from { transform: translateY(100%); } to { transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <header>
            <h1 id="title">마음 한잔</h1>
        </header>

        <div id="chatDisplay">
            <div class="bubble ai">안녕하세요. 오늘 하루는 어떠셨나요? <br>차 한 잔을 내어드리고 싶어요. 지금 어떤 차가 생각나시나요? (녹차, 홍차, 카모마일 등)</div>
        </div>

        <div class="input-area" id="inputZone">
            <textarea id="userInput" placeholder="편하게 적어주세요..."></textarea>
            <div class="controls">
                <span id="stepCount" class="step-info">대화의 시작</span>
                <button id="sendBtn" onclick="handleSend()">보내기</button>
            </div>
        </div>

        <div id="finalResult">
            <div style="font-family: 'Noto Serif KR', serif; margin-bottom: 20px; font-size: 1.2rem;">오늘의 마음 정리</div>
            <div id="analysisText" style="line-height: 1.8; color: #5d4037; margin-bottom: 30px;"></div>
            <button onclick="location.reload()" style="background: none; color: var(--accent-color); text-decoration: underline;">다시 차 한 잔 마시기</button>
        </div>
    </div>

    <script>
        let step = 0;
        let logs = [];
        const chatDisplay = document.getElementById('chatDisplay');
        const userInput = document.getElementById('userInput');
        const stepCount = document.getElementById('stepCount');

        function addBubble(type, text) {
            const bubble = document.createElement('div');
            bubble.className = `bubble ${type}`;
            bubble.innerHTML = text;
            chatDisplay.appendChild(bubble);
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        }

        function handleSend() {
            const text = userInput.value.trim();
            if (!text) return;

            addBubble('user', text);
            logs.push(text);
            userInput.value = "";
            step++;

            // 자연스러운 지연 시간을 주어 AI가 대답하는 느낌 생성
            setTimeout(() => {
                generateResponse(text);
            }, 800);
        }

        function generateResponse(userText) {
            if (step === 1) {
                const tea = userText.includes("차") ? userText : userText + " 차";
                addBubble('ai', `${tea}라니, 탁월한 선택이에요. 따뜻하게 준비해 드릴게요. <br><br>이제 본론으로 들어가서... 요즘 당신의 마음을 가장 어지럽게 만드는 한 가지는 무엇인가요?`);
                stepCount.innerText = "마음 열기";
            } 
            else if (step === 2) {
                addBubble('ai', "그렇군요... 그 일이 당신의 마음속에 어떤 감정을 남겼나요? 슬픔일 수도, 원망일 수도, 혹은 허무함일 수도 있겠네요.");
                stepCount.innerText = "깊이 들여다보기";
            } 
            else if (step === 3) {
                addBubble('ai', "이야기해주셔서 고마워요. 마지막으로 하나만 더 여쭤볼게요. <br><br>만약 당신이 가장 소중하게 생각하는 사람이 당신과 같은 고민을 하고 있다면, 그에게 어떤 말을 해주고 싶나요?");
                stepCount.innerText = "마지막 질문";
            } 
            else {
                showFinal();
            }
        }

        function showFinal() {
            const finalResult = document.getElementById('finalResult');
            const analysisText = document.getElementById('analysisText');
            const allText = logs.join(" ");

            let core = "";
            if (allText.match(/잘|성공|실수|실패|해야/)) {
                core = "<b>'완벽해야 한다는 책임감'</b>이 당신의 어깨를 무겁게 하고 있네요. 타인의 기준에 맞추려다 정작 소중한 당신의 속도를 잊은 것은 아닌지 돌아봐야 할 것 같아요.";
            } else if (allText.match(/혼자|누구|친구|사람|외롭/)) {
                core = "당신의 마음 깊은 곳에는 <b>'온전히 연결되고 싶은 갈망'</b>이 자리 잡고 있습니다. 누군가에게 기대고 싶은 마음은 약함이 아니라, 사랑이 많다는 증거이기도 합니다.";
            } else if (allText.match(/화|짜증|상처|그사람|말/)) {
                core = "당신은 현재 <b>'나를 지키고 싶은 방어 기제'</b>가 작동하고 있어요. 상처받지 않으려 마음의 문을 닫고 있지만, 사실은 누구보다 따뜻한 이해를 바라고 있군요.";
            } else {
                core = "당신은 지금 <b>'잠시 멈춰갈 휴식'</b>이 가장 필요한 상태입니다. 마음의 근원을 찾으려 너무 애쓰기보다, 오늘은 그저 고생한 자신을 푹 쉬게 해주는 건 어떨까요?";
            }

            analysisText.innerHTML = `${core}<br><br>오늘 나눈 이 대화가 당신의 밤을 조금 더 평온하게 만들기를 바랍니다.`;
            finalResult.style.display = 'flex';
        }

        // 엔터키 전송 지원
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                handleSend();
            }
        });
    </script>
</body>
</html>
