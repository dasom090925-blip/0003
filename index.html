<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>심야 찻집 - 마음 한잔</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;500;700&display=swap');

        :root {
            --paper: #f4f1ea;
            --ink: #3c3836;
            --tea-green: #6b705c;
            --wood: #a98467;
        }

        body {
            margin: 0; padding: 0;
            background-color: #2c2c2c;
            font-family: 'Noto Serif KR', serif;
            color: var(--ink);
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
        }

        .tea-house {
            width: 100%; max-width: 450px; height: 95vh;
            background-color: var(--paper);
            background-image: url('https://www.transparenttextures.com/patterns/paper-fibers.png');
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
            display: flex; flex-direction: column;
            position: relative; border: 8px solid #3e3e3e;
            overflow: hidden;
        }

        header {
            padding: 40px 20px 20px; text-align: center;
            border-bottom: 1px double var(--wood);
            flex-shrink: 0;
        }
        header h1 { font-weight: 700; font-size: 1.6rem; letter-spacing: 0.2rem; margin: 0; }
        header p { font-size: 0.85rem; color: var(--tea-green); margin-top: 10px; }

        #chatFlow {
            flex: 1; padding: 30px 20px; overflow-y: auto;
            display: flex; flex-direction: column; gap: 25px;
            scrollbar-width: none;
        }
        #chatFlow::-webkit-scrollbar { display: none; }

        .dialogue { opacity: 0; animation: fadeIn 1.2s forwards; line-height: 1.8; }
        .master { text-align: left; padding-right: 20%; position: relative; }
        .master::before { content: "茶"; color: var(--tea-green); font-size: 0.7rem; display: block; margin-bottom: 5px; }
        .guest { text-align: right; padding-left: 20%; color: var(--wood); font-style: italic; }

        .ink-tray {
            padding: 30px 20px; border-top: 1px solid rgba(169, 132, 103, 0.3);
            background: rgba(255,255,255,0.3);
            flex-shrink: 0;
        }
        textarea {
            width: 100%; background: transparent; border: none; border-bottom: 1px solid var(--wood);
            outline: none; font-family: 'Noto Serif KR', serif; font-size: 1rem;
            resize: none; color: var(--ink); padding-bottom: 10px;
        }

        .submit-btn { margin-top: 15px; text-align: right; }
        .submit-btn button {
            background: transparent; border: 1px solid var(--wood); padding: 8px 20px;
            font-family: 'Noto Serif KR', serif; color: var(--wood); cursor: pointer;
            transition: 0.3s;
        }
        .submit-btn button:hover { background: var(--wood); color: white; }

        /* 결과 화면 (다시 시작을 위해 스타일 수정) */
        #scrollResult {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: var(--paper);
            display: none; /* 기본 숨김 */
            flex-direction: column; justify-content: center;
            align-items: center; padding: 40px; text-align: center; z-index: 100;
            box-sizing: border-box;
        }
        .scroll-content { border: 1px solid var(--wood); padding: 30px; position: relative; background: rgba(255,255,255,0.2); }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="tea-house">
        <header>
            <h1>心夜 찻집</h1>
            <p>달빛 아래, 당신의 마음을 우려냅니다.</p>
        </header>

        <div id="chatFlow">
            <div class="dialogue master">어서 오세요. 찻물이 알맞게 익었습니다.<br>오늘은 어떤 차를 내어드릴까요? 당신의 기분을 닮은 차 이름을 적어주세요.</div>
        </div>

        <div class="ink-tray" id="inputContainer">
            <textarea id="guestInput" placeholder="붓을 들듯 천천히 적어주세요..." rows="1"></textarea>
            <div class="submit-btn">
                <button onclick="nextStep()">이야기 올리기</button>
            </div>
        </div>

        <div id="scrollResult">
            <div class="scroll-content">
                <p style="font-size: 0.8rem; color: var(--tea-green); margin-bottom: 20px;">[ 마음의 뿌리를 읽다 ]</p>
                <div id="rootCauseText" style="line-height: 2; font-size: 1.05rem;"></div>
                <button onclick="resetTeaHouse()" style="margin-top: 40px; background: none; border: none; color: var(--wood); cursor: pointer; text-decoration: underline; font-family: inherit;">다시 문을 두드리기</button>
            </div>
        </div>
    </div>

    <script>
        let step = 0;
        let story = [];
        const flow = document.getElementById('chatFlow');
        const input = document.getElementById('guestInput');
        const resultArea = document.getElementById('scrollResult');
        const inputContainer = document.getElementById('inputContainer');

        function addDialogue(role, text) {
            const div = document.createElement('div');
            div.className = `dialogue ${role}`;
            div.innerHTML = text;
            flow.appendChild(div);
            flow.scrollTop = flow.scrollHeight;
        }

        function nextStep() {
            const val = input.value.trim();
            if (!val) return;

            addDialogue('guest', val);
            story.push(val);
            input.value = "";
            step++;

            // 입력창 높이 초기화
            input.style.height = 'auto';

            setTimeout(() => {
                if (step === 1) {
                    addDialogue('master', `${val}... 향이 참 깊군요. <br><br>차 한 모금 넘기듯 묻겠습니다. 요즘 당신의 가슴 한구석을 자꾸만 건드리는 '그 일'은 무엇인가요?`);
                } else if (step === 2) {
                    addDialogue('master', `그랬군요. 그 일의 그림자가 당신을 얼마나 오랫동안 붙잡고 있었는지요... <br><br>그림자 너머, 당신이 사실은 간절히 지키고 싶었던 '당신의 모습'은 어떤 것이었습니까?`);
                } else if (step === 3) {
                    addDialogue('master', `이제 찻잔의 바닥이 보입니다. <br><br>그 모든 소란이 잦아든 고요한 밤, 당신의 마음이 가장 쉬고 싶어 하는 곳은 어디인가요?`);
                } else {
                    revealSource();
                }
            }, 1000);
        }

        function revealSource() {
            const resultText = document.getElementById('rootCauseText');
            const all = story.join(" ");

            let analysis = "";
            if (all.match(/일|공부|성공|잘|못|실수|과제|취업/)) {
                analysis = "당신은 <b>'자신에게 너무나도 엄격한 스승'</b>을 마음속에 두고 계시군요. <br>상처의 근원은 밖이 아니라, 스스로를 다그치는 그 높은 기준에 있습니다. <br>오늘은 당신의 서툰 모습조차 따뜻한 찻물로 안아주시길.";
            } else if (all.match(/사람|친구|그애|말|상처|버린|연애|이별/)) {
                analysis = "당신의 상처는 <b>'누구보다 깊은 사랑을 주고받고 싶은 갈망'</b>에서 피어났습니다. <br>뿌리가 깊은 나무일수록 바람에 흔들리는 법이니, <br>사람에 흔들리는 당신은 그만큼 뿌리가 깊은 사람이라는 뜻이기도 합니다.";
            } else if (all.match(/나|자신|왜|바보|싫|내탓/)) {
                analysis = "당신의 마음은 지금 <b>'나 자신과의 화해'</b>를 간절히 기다리고 있습니다. <br>상처의 근원은 스스로를 미워하는 작은 습관들이 쌓인 것이겠지요. <br>찻잔 속의 당신을 가만히 들여다보며, '미안하다'고 한마디 건네보세요.";
            } else {
                analysis = "당신은 그저 <b>'온전한 고요'</b>를 잊고 지내오셨군요. <br>상처의 원인이 무엇이든, 지금 당신에게 필요한 것은 답을 찾는 것이 아니라 <br>찻잔의 온기처럼 당신을 따뜻하게 덮어줄 시간입니다.";
            }

            resultText.innerHTML = analysis;
            resultArea.style.display = 'flex';
        }

        // 초기화 함수: 모든 상태를 처음으로 돌림
        function resetTeaHouse() {
            // 1. 데이터 초기화
            step = 0;
            story = [];
            
            // 2. UI 초기화
            resultArea.style.display = 'none';
            flow.innerHTML = '<div class="dialogue master">어서 오세요. 찻물이 알맞게 익었습니다.<br>오늘은 어떤 차를 내어드릴까요? 당신의 기분을 닮은 차 이름을 적어주세요.</div>';
            input.value = "";
            input.style.height = 'auto';
            
            // 3. 입력창 활성화 (혹시 비활성화했다면)
            input.disabled = false;
        }

        // 입력창 자동 높이 조절
        input.addEventListener('input', function() {
            this.style.height = 'auto';
            this.style.height = (this.scrollHeight) + 'px';
        });

        // 엔터키 전송
        input.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault();
                nextStep();
            }
        });
    </script>
</body>
</html>
