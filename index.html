<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>마음 한잔 - 근원 찾기</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap');

        :root {
            --primary-brown: #6d4c41;
            --soft-brown: #8d6e63;
            --bg-color: #fdfaf9;
        }

        body {
            margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Noto Sans KR', sans-serif;
            color: #4e342e;
        }

        .container {
            width: 95%; max-width: 500px;
            background: rgba(255, 255, 255, 0.98);
            padding: 30px; border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
            position: relative; overflow: hidden;
        }

        /* Progress Bar */
        .progress-container { width: 100%; height: 4px; background: #eee; margin-bottom: 20px; border-radius: 2px; display: none; }
        #progressBar { width: 0%; height: 100%; background: var(--soft-brown); transition: width 0.5s; border-radius: 2px; }

        h1 { font-size: 1.6rem; color: var(--primary-brown); margin-bottom: 10px; }
        .subtitle { font-size: 0.9rem; color: #a1887f; margin-bottom: 25px; }

        /* Tea Selector */
        .tea-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 20px; }
        .tea-option { cursor: pointer; padding: 12px; border: 1px solid #efebe9; border-radius: 12px; font-size: 0.85rem; transition: 0.3s; background: #fff; }
        .tea-option.active { background: var(--soft-brown); color: white; border-color: var(--soft-brown); }

        /* Input Area */
        #chatDisplay { max-height: 200px; overflow-y: auto; margin-bottom: 20px; text-align: left; padding: 10px; border-radius: 10px; background: #fcfaf9; display: none; }
        .msg { margin-bottom: 10px; font-size: 0.9rem; line-height: 1.5; padding: 10px; border-radius: 10px; }
        .ai-msg { background: #efebe9; color: #4e342e; border-bottom-left-radius: 2px; }
        
        textarea { width: 100%; height: 110px; padding: 15px; border: 1.5px solid #d7ccc8; border-radius: 18px; resize: none; box-sizing: border-box; outline: none; font-size: 1rem; transition: 0.3s; }
        textarea:focus { border-color: var(--soft-brown); box-shadow: 0 0 8px rgba(141, 110, 99, 0.2); }

        button { width: 100%; margin-top: 15px; padding: 15px; border: none; border-radius: 15px; background: var(--soft-brown); color: white; cursor: pointer; font-weight: 500; font-size: 1rem; }
        button:hover { background: var(--primary-brown); }

        /* Final Result */
        #analysisResult { display: none; text-align: left; background: #fff; padding: 20px; border: 1px dashed var(--soft-brown); border-radius: 20px; margin-top: 20px; animation: fadeIn 1s; }
        .root-cause { font-size: 1.1rem; color: #d32f2f; font-weight: 700; display: block; margin: 10px 0; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>

    <div class="container">
        <div id="loginSection">
            <h1>마음 한잔</h1>
            <p class="subtitle">오롯이 당신만을 위한 대화의 공간입니다.</p>
            <input type="text" id="userName" style="width:80%; padding:12px; border:1px solid #ddd; border-radius:10px;" placeholder="이름 혹은 별명">
            <button onclick="startApp()" style="margin-top:20px;">대화 시작하기</button>
        </div>

        <div id="mainContent" style="display:none;">
            <div class="progress-container" id="pContainer"><div id="progressBar"></div></div>
            <h1 id="welcomeTitle">마음 한잔</h1>
            <p id="mainSubtitle" class="subtitle">먼저, 지금 마시고 싶은 차를 골라주세요.</p>

            <div id="step1">
                <div class="tea-selector">
                    <div class="tea-option active" onclick="selectTea('말차', this)">말차</div>
                    <div class="tea-option" onclick="selectTea('우롱차', this)">우롱차</div>
                    <div class="tea-option" onclick="selectTea('카모마일', this)">카모마일</div>
                </div>
            </div>

            <div id="chatDisplay"></div>
            
            <textarea id="userInput" placeholder="요즘 당신의 마음을 무겁게 하는 것은 무엇인가요?"></textarea>
            <button id="actionBtn" onclick="processStep()">이야기 나누기</button>
            
            <div id="analysisResult">
                <strong style="color:var(--soft-brown);">[마음의 근원 분석 보고서]</strong>
                <p id="analysisText"></p>
                <div id="rootCauseDisplay"></div>
                <button onclick="location.reload()" style="background:#a1887f; font-size:0.8rem; padding:8px;">새로운 대화 시작</button>
            </div>
        </div>
    </div>

    <script>
        let step = 0;
        let userName = "";
        let selectedTea = "말차";
        let responses = [];
        const MAX_STEPS = 3;

        function startApp() {
            userName = document.getElementById('userName').value || "손님";
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('welcomeTitle').innerText = `${userName}님의 티타임`;
        }

        function selectTea(tea, el) {
            selectedTea = tea;
            document.querySelectorAll('.tea-option').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        function addChat(role, text) {
            const display = document.getElementById('chatDisplay');
            display.style.display = 'block';
            const msgDiv = document.createElement('div');
            msgDiv.className = `msg ${role}-msg`;
            msgDiv.innerText = text;
            display.appendChild(msgDiv);
            display.scrollTop = display.scrollHeight;
        }

        function processStep() {
            const input = document.getElementById('userInput').value;
            if (!input) { alert("잠시라도 좋으니 마음을 적어주세요."); return; }
            
            responses.push(input);
            document.getElementById('userInput').value = "";
            document.getElementById('pContainer').style.display = 'block';
            
            step++;
            const progress = (step / (MAX_STEPS + 1)) * 100;
            document.getElementById('progressBar').style.width = `${progress}%`;

            if (step === 1) {
                document.getElementById('step1').style.display = 'none';
                document.getElementById('mainSubtitle').innerText = "당신의 깊은 속마음을 따라가는 중입니다.";
                addChat('ai', `따뜻한 ${selectedTea} 한 잔 드릴게요. 그 일이 당신을 구체적으로 어떻게 아프게 하나요? 조금 더 깊이 말씀해 주시겠어요?`);
            } else if (step === 2) {
                addChat('ai', "그 감정의 가장 밑바닥에는 어떤 두려움이나 소망이 숨어있을까요? 아주 솔직해져도 괜찮습니다.");
            } else if (step === 3) {
                addChat('ai', "마지막으로 묻고 싶어요. 만약 그 상황이 없었더라면, 당신은 어떤 모습으로 웃고 있었을까요?");
                document.getElementById('actionBtn').innerText = "나의 근원 확인하기";
            } else {
                showFinalAnalysis();
            }
        }

        function showFinalAnalysis() {
            document.getElementById('chatDisplay').style.display = 'none';
            document.getElementById('userInput').style.display = 'none';
            document.getElementById('actionBtn').style.display = 'none';
            document.getElementById('mainSubtitle').innerText = "대화를 통해 발견한 당신의 진심입니다.";

            const analysisResult = document.getElementById('analysisResult');
            const analysisText = document.getElementById('analysisText');
            const rootDisplay = document.getElementById('rootCauseDisplay');
            
            const fullText = responses.join(" ");
            
            // 심리 근원 로직 (키워드 매칭 확장)
            let result = {
                title: "인정받고 싶은 마음",
                desc: "당신의 고통은 사실 '나의 가치를 확인받지 못할까 봐' 하는 두려움에서 시작된 것 같습니다. 스스로를 증명하려 애쓰지 않아도 당신은 이미 소중합니다."
            };

            if (fullText.match(/혼자|버려진|외롭|무관심|연락/)) {
                result = { title: "연결되고 싶은 갈망", desc: "누군가에게 온전히 이해받고 싶어 하는 마음이 상처의 뿌리에 있습니다. 외로움은 당신이 사랑이 많은 사람이기 때문에 느끼는 감정입니다." };
            } else if (fullText.match(/실수|완벽|실패|망칠까봐|공부|성적/)) {
                result = { title: "자신을 향한 높은 잣대", desc: "당신의 상처는 외부가 아닌 '스스로를 용서하지 못하는 마음'에서 기인합니다. 가끔은 넘어져도 괜찮다는 허락이 당신에게 가장 필요해 보입니다." };
            } else if (fullText.match(/상처|욕|비난|사람들|눈치/)) {
                result = { title: "보호받고 싶은 안전감", desc: "주변 환경이나 타인으로부터 나를 지키고 싶은 방어 기제가 상처의 원인입니다. 당신의 예민함은 사실 자신을 지키기 위한 소중한 안테나입니다." };
            }

            analysisText.innerText = `${userName}님, 대화를 통해 본 당신의 상처의 근원은...`;
            rootDisplay.innerHTML = `<span class="root-cause">"${result.title}"</span><p style="font-size:0.9rem; line-height:1.6;">${result.desc}</p>`;
            analysisResult.style.display = 'block';
        }
    </script>
</body>
</html>
