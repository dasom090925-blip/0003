<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆìŒ í•œì” - ê¹Šì€ ëŒ€í™”</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;500;700&display=swap');

        body {
            margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh;
            background: linear-gradient(180deg, #fdfbfb 0%, #ebedee 100%);
            font-family: 'Noto Sans KR', sans-serif;
            color: #4e342e;
        }

        .container {
            width: 90%; max-width: 480px;
            background: rgba(255, 255, 255, 0.95);
            padding: 40px; border-radius: 40px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.08);
            text-align: center;
        }

        #loginSection { margin-bottom: 20px; }
        .input-field { padding: 12px; border: 1px solid #d7ccc8; border-radius: 10px; width: 70%; margin-bottom: 10px; outline: none; }

        #mainContent { display: none; }

        h1 { font-size: 1.8rem; margin-bottom: 8px; color: #6d4c41; font-weight: 700; }
        .subtitle { font-size: 0.95rem; color: #8d6e63; margin-bottom: 20px; }

        .tea-selector { display: grid; grid-template-columns: repeat(3, 1fr); gap: 8px; margin-bottom: 20px; }
        .tea-option { cursor: pointer; padding: 10px; border: 1px solid #d7ccc8; border-radius: 15px; font-size: 0.8rem; background: white; transition: 0.3s; }
        .tea-option.active { background-color: #8d6e63; color: white; border-color: #8d6e63; }

        textarea { width: 100%; height: 100px; padding: 18px; border: 1px solid #d7ccc8; border-radius: 20px; resize: none; box-sizing: border-box; outline: none; background-color: #fcfaf9; font-size: 1rem; line-height: 1.6; transition: all 0.3s; }

        button { margin-top: 15px; padding: 14px 40px; border: none; border-radius: 35px; background: #8d6e63; color: white; cursor: pointer; font-weight: 500; transition: 0.3s; }
        button:disabled { background: #d7ccc8; cursor: default; }

        #resultSection {
            margin-top: 25px; padding: 20px; background: #fdfaf9; border-radius: 20px;
            border: 1px solid #efebe9; display: none; text-align: left; animation: fadeIn 0.8s ease-out;
        }
        .comfort-text { color: #5d4037; font-weight: 500; margin-bottom: 10px; line-height: 1.6; font-size: 0.95rem; }
        .ask-more { color: #8d6e63; font-size: 0.9rem; border-top: 1px solid #eee; padding-top: 15px; text-align: center; }
        .btn-small { padding: 8px 15px; font-size: 0.8rem; margin-top: 10px; background: #a1887f; border: none; border-radius: 15px; color: white; cursor: pointer; }
        
        #deepQuestion { margin-top: 10px; padding: 15px; background: #fff; border-radius: 15px; border-left: 4px solid #8d6e63; color: #4e342e; font-weight: 500; line-height: 1.6; box-shadow: 0 4px 10px rgba(0,0,0,0.03); }

        .count-badge { font-size: 0.7rem; color: #a1887f; margin-bottom: 5px; display: block; }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <div class="container">
        <div id="loginSection">
            <h1>ë§ˆìŒ í•œì”</h1>
            <p class="subtitle">ì˜¤ì…¨ë‚˜ìš”? ë‹¹ì‹ ì˜ ì´ë¦„ì„ ì•Œë ¤ì£¼ì„¸ìš”.</p>
            <input type="text" id="userName" class="input-field" placeholder="ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <br>
            <button onclick="login()">ì…ì¥í•˜ê¸°</button>
        </div>

        <div id="mainContent">
            <h1 id="welcomeMsg">í™˜ì˜í•©ë‹ˆë‹¤</h1>
            <p class="subtitle">ì˜¤ëŠ˜ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ì±„ì›Œì¤„ ì°¨ë¥¼ ê³¨ë¼ë³´ì„¸ìš”.</p>

            <div class="tea-selector">
                <div class="tea-option active" onclick="selectTea('ë…¹ì°¨', this)">ë…¹ì°¨</div>
                <div class="tea-option" onclick="selectTea('í™ì°¨', this)">í™ì°¨</div>
                <div class="tea-option" onclick="selectTea('í—ˆë¸Œì°¨', this)">í—ˆë¸Œì°¨</div>
                <div class="tea-option" onclick="selectTea('ìœ ìì°¨', this)">ìœ ìì°¨</div>
                <div class="tea-option" onclick="selectTea('ë³´ë¦¬ì°¨', this)">ë³´ë¦¬ì°¨</div>
                <div class="tea-option" onclick="selectTea('ì½”ì½”ì•„', this)">ì½”ì½”ì•„</div>
            </div>

            <div id="chatArea">
                <textarea id="userInput" placeholder="ëˆ„êµ¬ì—ê²Œë„ í•˜ì§€ ëª»í•œ ë§ì„ ì´ê³³ì— ë‚¨ê²¨ë³´ì„¸ìš”..."></textarea>
                <button id="mainBtn" onclick="provideComfort()">ë§ˆìŒ ë‚˜ëˆ„ê¸°</button>
            </div>

            <div id="resultSection">
                <span id="stepCount" class="count-badge"></span>
                <div id="comfortOutput" class="comfort-text"></div>
                <div id="deepQuestion"></div>
                
                <div id="questionWrapper" class="ask-more">
                    <p id="promptText" style="margin: 0;">ì§€ê¸ˆ ê·¸ ë§ˆìŒ... <strong>ë” ìì„¸íˆ ë¬¼ì–´ë´ë„ ê´œì°®ì„ê¹Œìš”?</strong></p>
                    <button id="deepBtn" class="btn-small" onclick="askDeepQuestion()">ë„¤, ì´ì•¼ê¸°í• ë˜ìš”</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentUser = "";
        let selectedTea = "ë…¹ì°¨";
        let questionCount = 0;
        const MAX_QUESTIONS = 3;
        let userAnswers = []; // ì‚¬ìš©ìì˜ ë‹µë³€ì„ ì €ì¥í•˜ì—¬ ì›ì¸ ë¶„ì„ì— í™œìš©

        const questionBank = {
            people: [
                "ê·¸ ê´€ê³„ì—ì„œ ë‹¹ì‹ ì´ ê°€ì¥ ì§€í‚¤ê³  ì‹¶ì—ˆë˜ ë§ˆìŒì€ ë¬´ì—‡ì´ì—ˆë‚˜ìš”?",
                "ìƒëŒ€ë°©ì˜ ë§ ì¤‘ ì–´ë–¤ ë¶€ë¶„ì´ ë‹¹ì‹ ì˜ ë§ˆìŒì„ ê°€ì¥ ì•„í”„ê²Œ ì°”ë €ë‚˜ìš”?",
                "ìƒì²˜ë¥¼ ì¤€ ê·¸ ì‚¬ëŒì—ê²Œ ì‚¬ì‹¤ì€ ì–´ë–¤ ëŒ€ë‹µì„ ë“£ê³  ì‹¶ì—ˆë‚˜ìš”?"
            ],
            work: [
                "ë‹¹ì‹ ì„ ê°€ì¥ ì§€ì¹˜ê²Œ í•˜ëŠ” ê±´ 'í•´ì•¼ í•  ì¼'ì¸ê°€ìš”, ì•„ë‹ˆë©´ 'ì˜í•´ì•¼ í•œë‹¤ëŠ” ì••ë°•'ì¸ê°€ìš”?",
                "ì§€ê¸ˆì˜ ë…¸ë ¥ì´ ë‹¹ì‹ ì´ ì§„ì‹¬ìœ¼ë¡œ ì›í•˜ëŠ” ë¯¸ë˜ì™€ ë§ë‹¿ì•„ ìˆë‚˜ìš”?",
                "ì ì‹œ ë©ˆì¶˜ë‹¤ë©´, ë‹¹ì‹ ì˜ ì‚¶ì—ì„œ ë¬´ì—‡ì´ ë¬´ë„ˆì§ˆê¹Œ ë´ ê°€ì¥ ë‘ë ¤ìš°ì‹ ê°€ìš”?"
            ],
            self: [
                "ìŠ¤ìŠ¤ë¡œì—ê²Œ ë„ˆë¬´ ì—„ê²©í•œ ì£ëŒ€ë¥¼ ëŒ€ê³  ìˆëŠ” ê²ƒì€ ì•„ë‹ê¹Œìš”?",
                "ì˜¤ëŠ˜ í•˜ë£¨ ì¤‘ ì•„ì£¼ ì§§ê²Œë¼ë„ ë‹¹ì‹ ì´ ìŠ¤ìŠ¤ë¡œë¥¼ ëŒ€ê²¬í•˜ê²Œ ì—¬ê²¼ë˜ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?",
                "ë‹¹ì‹ ì„ í˜ë“¤ê²Œ í•˜ëŠ” ê·¸ ìƒê°ì€ 'ì‚¬ì‹¤'ì¸ê°€ìš”, ì•„ë‹ˆë©´ 'ë¶ˆì•ˆì´ ë§Œë“  ìƒìƒ'ì¸ê°€ìš”?"
            ],
            general: [
                "ê·¸ ê³ ë¯¼ì˜ ë¿Œë¦¬ë¥¼ ë”°ë¼ê°€ë©´, ì–´ë–¤ ê°ì •ì´ ê°€ì¥ ë¨¼ì € ë‚˜íƒ€ë‚˜ë‚˜ìš”?",
                "ì§€ê¸ˆ ê°€ì¥ í•„ìš”í•œ ê±´ í•´ê²°ì±…ì¼ê¹Œìš”, ì•„ë‹ˆë©´ ì˜¨ì „í•œ íœ´ì‹ì¼ê¹Œìš”?",
                "ì´ ìƒí™©ì´ í•´ê²°ëœë‹¤ë©´, ë‹¹ì‹ ì˜ í‘œì •ì€ ì–´ë–»ê²Œ ë³€í• ê¹Œìš”?"
            ]
        };

        function login() {
            const name = document.getElementById('userName').value;
            if (!name) return alert("ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.");
            currentUser = name;
            document.getElementById('loginSection').style.display = 'none';
            document.getElementById('mainContent').style.display = 'block';
            document.getElementById('welcomeMsg').innerText = `${name}ë‹˜ì˜ ë§ˆìŒ í•œì”`;
        }

        function selectTea(name, el) {
            selectedTea = name;
            document.querySelectorAll('.tea-option').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        function provideComfort() {
            const input = document.getElementById('userInput').value;
            if (!input) return alert("ë‹¹ì‹ ì˜ ë§ˆìŒì„ í•œ ë§ˆë””ë§Œ ë“¤ë ¤ì£¼ì„¸ìš”.");

            userAnswers.push(input); // ì²« ì…ë ¥ ì €ì¥
            
            const resultSection = document.getElementById('resultSection');
            const comfortOutput = document.getElementById('comfortOutput');
            const deepQuestionDiv = document.getElementById('deepQuestion');

            comfortOutput.innerText = `ë”°ëœ»í•œ ${selectedTea} í•œ ì”ì„ ê±´ë„µë‹ˆë‹¤. ë‹¹ì‹ ì˜ ê¸€ì—ì„œ ê·¸ë™ì•ˆ ì–¼ë§ˆë‚˜ ì°¸ì•„ì™”ì„ì§€ ëŠê»´ì ¸ìš”. í˜¼ìì„œ ì§Šì–´ì§€ëŠë¼ ì •ë§ ì• ì“°ì…¨ìŠµë‹ˆë‹¤.`;
            resultSection.style.display = 'block';
            deepQuestionDiv.style.display = 'none';
            
            // UI ì „í™˜: ì…ë ¥ì°½ì„ ì§ˆë¬¸ ì•„ë˜ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ìœ ë„
            document.getElementById('mainBtn').style.display = 'none';
            document.getElementById('userInput').value = "";
            document.getElementById('userInput').placeholder = "ì´ê³³ì— ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ë¥¼ ì´ì–´ê°€ì£¼ì„¸ìš”...";
        }

        function askDeepQuestion() {
            const input = document.getElementById('userInput').value;
            
            // ì§ˆë¬¸ ë‹¨ê³„ê°€ ì§„í–‰ ì¤‘ì¼ ë•Œ ì…ë ¥ ê²€ì‚¬
            if (questionCount > 0 && !input) {
                return alert("ë‹µë³€ì„ ì…ë ¥í•´ì£¼ì‹œë©´ ëŒ€í™”ë¥¼ ê³„ì† ì´ì–´ê°ˆ ìˆ˜ ìˆì–´ìš”.");
            }
            if(input) userAnswers.push(input);

            questionCount++;

            if (questionCount <= MAX_QUESTIONS) {
                document.getElementById('stepCount').innerText = `ê¹Šì€ ëŒ€í™” ë‹¨ê³„: ${questionCount} / ${MAX_QUESTIONS}`;
                
                let category = analyzeCategory(userAnswers.join(" "));
                const questions = questionBank[category];
                const currentQ = questions[questionCount - 1];

                document.getElementById('comfortOutput').innerText = "ì¡°ê¸ˆ ë” ê¹Šì´ ë“¤ì—¬ë‹¤ë³¼ê¹Œìš”? ë‹¹ì‹ ì˜ ì´ì•¼ê¸°ì— ê·€ ê¸°ìš¸ì´ê³  ìˆì–´ìš”.";
                const qDiv = document.getElementById('deepQuestion');
                qDiv.innerText = "ğŸ’¡ " + currentQ;
                qDiv.style.display = 'block';
                
                document.getElementById('userInput').value = "";
                document.getElementById('userInput').focus();
                document.getElementById('deepBtn').innerText = "ë‹¤ìŒ ì´ì•¼ê¸° ë“¤ë ¤ì£¼ê¸°";
                document.getElementById('promptText').innerHTML = "ìƒê°ë‚˜ëŠ” ëŒ€ë¡œ ì²œì²œíˆ ì ì–´ì£¼ì…”ë„ ê´œì°®ì•„ìš”.";

                if (questionCount === MAX_QUESTIONS) {
                    document.getElementById('deepBtn').innerText = "ëŒ€í™” ë§ˆë¬´ë¦¬í•˜ê¸°";
                }
            } else {
                finishConversation();
            }
        }

        function analyzeCategory(text) {
            if (text.match(/ì‚¬ëŒ|ì¹œêµ¬|ìƒì‚¬|ë™ë£Œ|ê°€ì¡±|ì—„ë§ˆ|ì•„ë¹ |ë§|ê´€ê³„/)) return "people";
            if (text.match(/ì¼|ê³µë¶€|ì‹œí—˜|ì„±ì |ì·¨ì—…|íšŒì‚¬|ì„±ê³µ|ê³¼ì œ/)) return "work";
            if (text.match(/ë‚˜|ë‚´|ìì‹ |ì„±ê²©|ìì±…|í›„íšŒ|ë°”ë³´/)) return "self";
            return "general";
        }

        function finishConversation() {
            const finalComfort = document.getElementById('comfortOutput');
            const qDiv = document.getElementById('deepQuestion');
            const wrapper = document.getElementById('questionWrapper');
            const input = document.getElementById('userInput');

            // ê°„ë‹¨í•œ ì›ì¸ ë¶„ì„ ë¡œì§ (í‚¤ì›Œë“œ ê¸°ë°˜)
            let cause = "ë§ˆìŒì† ê¹Šì€ ê³³ì˜ ë¶ˆì•ˆ";
            let fullText = userAnswers.join(" ");
            if(fullText.includes("ì‚¬ëŒ") || fullText.includes("ë§")) cause = "íƒ€ì¸ì˜ ì‹œì„ ê³¼ ê´€ê³„ì—ì„œ ì˜¤ëŠ” ë¬´ê²Œ";
            else if(fullText.includes("ì¼") || fullText.includes("ì˜")) cause = "ì™„ë²½í•´ì•¼ í•œë‹¤ëŠ” ì±…ì„ê°";
            else if(fullText.includes("í›„íšŒ") || fullText.includes("ë‚˜")) cause = "ìŠ¤ìŠ¤ë¡œë¥¼ í–¥í•œ ë†’ì€ ê¸°ëŒ€ì¹˜";

            finalComfort.innerHTML = `<strong>ì˜¤ëŠ˜ì˜ ëŒ€í™” ìš”ì•½</strong><br>ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì–´ë³´ë‹ˆ ë‹¹ì‹ ì˜ ìƒì²˜ëŠ” <u>'${cause}'</u>ì—ì„œ ì‹œì‘ëœ ê²ƒ ê°™ë„¤ìš”.`;
            qDiv.innerText = "ì¶©ë¶„íˆ ë§ì€ ì´ì•¼ê¸°ë¥¼ ë‚˜ëˆ„ì–´ ì£¼ì…¨ìŠµë‹ˆë‹¤. ì˜¤ëŠ˜ ë‚˜ëˆˆ ë§ë“¤ì´ ë‹¹ì‹ ì˜ ë§ˆìŒ í•œêµ¬ì„ì„ ì¡°ê¸ˆì´ë‚˜ë§ˆ ê°€ë³ê²Œ í•´ì£¼ì—ˆê¸°ë¥¼ ë°”ëë‹ˆë‹¤. ë‹¹ì‹ ì€ ì¶©ë¶„íˆ ì˜í•˜ê³  ìˆì–´ìš”.";
            
            wrapper.innerHTML = "<button class='btn-small' onclick='location.reload()'>ì²˜ìŒìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>";
            input.disabled = true;
            input.placeholder = "ì˜¤ëŠ˜ì˜ ëŒ€í™”ê°€ í‰ì•ˆíˆ ë§ˆë¬´ë¦¬ë˜ì—ˆìŠµë‹ˆë‹¤.";
        }
    </script>
</body>
</html>
